@inject IJSRuntime JS;
@inject NavigationManager Navs
@inject GospelReachCapstone.Services.FirebaseAuthenticationService AuthService
@inject GospelReachCapstone.Services.AppState _appState
@inject AuthState auth
@* @inherits ProtectedPageBase *@

<div class="side-parent">
    <div class="side-parent-content">
        <nav class="w-100">
            <!--Pages Section-->
            <div class="@GetClass(0, "link")" @onclick="() => SetActive(0)">
                <i class="bi bi-house-door"></i>
                <a href="dashboard" class="text-decoration-none c2">Dashboard</a>
            </div>


            <!--Management-->
            <h3 class="sidebar-heading">MANAGEMENT</h3>

            <!--Admin-->
            <div class="@GetClass(1, "link")" @onclick="() => SetActive(1)">
                <div class="d-flex align-items-center">
                    <i class="bi bi-person"></i>
                </div>
                <a href="user-management" class="text-decoration-none c2">User<br />Management</a>
            </div>

            <!--Departments-->
            <div class="@GetClass(2, "links")" @onclick="() => SetActive(2)">
                <div class="dep">
                    <div class="d-flex align-items-center">
                        <i class="bi bi-building"></i>
                    </div>
                    @* <a href="departments" class="text-decoration-none c2">Departments</a> *@
                    <p class="m-0 p-0 c2 dp">Departments</p>
                </div>
                
                <div @onclick:stopPropagation class="subDepartment @(isSubDepartmentVisible ? "" : "hide")">
                    <div>
                        <p class="ds">Senior</p>
                        <div>
                            <p @onclick="@(() => GoToDepartmentPage("Senior General"))" class="ms-3 ds hov">Senior General</p>
                            <p class="ms-3 ds hov">Music</p>
                        </div>
                    </div>
                    <div>
                        <p class="ds">Womens</p>
                        <div>
                            <p @onclick="@(() => GoToDepartmentPage("Homeleague"))" class="ms-3 ds hov">Homeleague</p>
                            <p @onclick="@(() => GoToDepartmentPage("Teenstuff"))" class="ms-3 ds hov">Teenstuff</p>
                        </div>
                    </div>
                    <p class="ds hov" @onclick="@(() => GoToDepartmentPage("Mens"))">Mens</p>
                    <div>
                        <p class="ds">Youth</p>
                        <div>
                            <p class="ms-3 ds hov">YP General</p>
                            <p @onclick="@(() => GoToDepartmentPage("Torchbearer"))" class="ms-3 ds hov">Torchbearer</p>
                        </div>
                    </div>
                </div>
            </div>

            <!--Member Management-->
            <div class="@GetClass(3, "link")" @onclick="() => SetActive(3)">
                <div class="d-flex align-items-center">
                    <i class="bi bi-people"></i>
                </div>
                <a href="membermanagement" class="text-decoration-none c2">Member<br />Management</a>
            </div>

            <!--Visitor Management-->
            <div class="@GetClass(10, "link")" @onclick="() => SetActive(10)">
                <div class="d-flex align-items-center">
                    <i class="bi bi-person-gear"></i>
                </div>
                <a href="visitors" class="text-decoration-none c2">Visitor<br />Management</a>
            </div>

            <!--Group Management-->
            <div class="@GetClass(4, "link")" @onclick="() => SetActive(4)">
                <div class="d-flex align-items-center">
                    <i class="bi bi-bell"></i>
                </div>
                <a href="notification" class="text-decoration-none c2">Notification<br />Management</a>
            </div>

            <!--Tracking-->
            <h3 class="sidebar-heading">TRACKING</h3>

            <!--Attendance-->
            <div class="@GetClass(5, "link")" @onclick="() => SetActive(5)">
                <div class="d-flex align-items-center">
                    <i class="bi bi-bar-chart"></i>
                </div>
                <a href="attendance" class="text-decoration-none c2">Attendance</a>
            </div>

            <!--Finance-->
            <div class="@GetClass(6, "link")" @onclick="() => SetActive(6)">
                <div class="d-flex align-items-center">
                    <i class="bi bi-piggy-bank"></i>
                </div>
                <a href="finance" class="text-decoration-none c2">Finance</a>
            </div>

            <!--Content-->
            <h3 class="sidebar-heading">CONTENT</h3>

            <!--Media Files-->
            <div class="@GetClass(7, "link")" @onclick="() => SetActive(7)">
                <div class="d-flex align-items-center">
                    <i class="bi bi-film"></i>
                </div>
                <a href="media" class="text-decoration-none c2">Media Files</a>
            </div>

            <!--Music-->
            <div class="@GetClass(8, "link")" @onclick="() => SetActive(8)">
                <div class="d-flex align-items-center">
                    <i class="bi bi-music-note"></i>
                </div>
                <a href="music" class="text-decoration-none c2">Music</a>
            </div>

            <!--Planning-->
            <h3 class="sidebar-heading">PLANNING</h3>

            <!--Events-->
            @* <div class="@GetClass(8, "link")" @onclick="() => SetActive(8)">
                <div class="d-flex align-items-center">
                    <i class="bi bi-calendar-check"></i>
                </div>
                <a href="events" class="text-decoration-none c2">Events</a>
            </div> *@

            <!--Schedules-->
            <div class="@GetClass(9, "link")" @onclick="() => SetActive(9)">
                <div class="d-flex align-items-center">
                    <i class="bi bi-clock"></i>
                </div>
                <a href="schedules" class="text-decoration-none c2">Schedules</a>
            </div>
        </nav>
    </div>

    <!--Users Section-->
    <div class="side-foot d-flex align-items-center justify-content-between gap-2">
        <div class="d-flex align-items-center gap-2">
            <div class="profile">
                <p>@initialName</p>
            </div>
            <div>
                <p class="fs-6 m-0">@auth.DisplayName</p>
                <p class="c2 m-0" style="font-size:12px;">@auth.Role</p>
            </div>
        </div>
        
        <button class="btn p-0" @onclick="Logout"><i class="bi bi-box-arrow-right fs-4"></i></button>
    </div>
</div>


@code {
    [Parameter]
    public EventCallback OnActiveChanged { get; set; }
    private char initialName = 'A';
    private int activeIndex = 0;
    private bool isSubDepartmentVisible { get; set; } = false;

    protected override void OnInitialized()
    {
        getInitial();
    }

    private void getInitial()
    {
        if (auth.DisplayName != null)
        {
            initialName = auth.DisplayName[0];
        }
    }

    private async Task SetActive(int index)
    {
        activeIndex = index;
        switch (index)
        {
            case 0:
                Navs.NavigateTo("dashboard");
                isSubDepartmentVisible = false;
                break;
            case 1:
                Navs.NavigateTo("user-management");
                isSubDepartmentVisible = false;
                break;
            case 2:
                // Navs.NavigateTo("departments");
                isSubDepartmentVisible = !isSubDepartmentVisible;
                break;
            case 3:
                Navs.NavigateTo("membermanagement");
                isSubDepartmentVisible = false;
                break;
            case 4:
                Navs.NavigateTo("notification");
                isSubDepartmentVisible = false;
                break;
            case 5:
                Navs.NavigateTo("attendance");
                isSubDepartmentVisible = false;
                break;
            case 6:
                Navs.NavigateTo("finance");
                isSubDepartmentVisible = false;
                break;
            case 7:
                Navs.NavigateTo("media");
                isSubDepartmentVisible = false;
                break;
            case 8:
                Navs.NavigateTo("music");
                isSubDepartmentVisible = false;
                break;
            case 9:
                Navs.NavigateTo("schedules");
                isSubDepartmentVisible = false;
                break;
            case 10:
                Navs.NavigateTo("visitors");
                isSubDepartmentVisible = false;
                break;

        }
        await OnActiveChanged.InvokeAsync(); //Notify the homelayout
    }

    private string GetClass(int index, string baseClass)
    {
        return $"{baseClass}{(activeIndex == index ? " active" : "")}";
    }

    private async Task Logout()
    {
        bool confirm = await JS.InvokeAsync<bool>("confirm", "Are you sure you want to logout?");

        if (!confirm) return;
        await AuthService.LogoutAsync();

        Navs.NavigateTo("/");
    }

    private void GoToDepartmentPage(string name)
    {
        _appState.SelectedDepartmentName = name;
        Navs.NavigateTo($"departments/{name}");
    }
}
